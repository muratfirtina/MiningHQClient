<div class="modern-maintenance-add-page" *ngIf="machine">
  
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-btn" (click)="goBack()">
          <i class="fas fa-arrow-left"></i>
          Geri
        </button>
        <h1 class="page-title">
          <i class="fas fa-tools"></i>
          Bakım-Onarım Kaydı Ekle
        </h1>
        <p class="page-subtitle">{{ machine.name }} - {{ machine.brandName }} {{ machine.modelName }}</p>
      </div>
    </div>
  </div>

  <div class="container-custom">
    
    <div class="main-content">
      
      <!-- Maintenance Form -->
      <div class="form-section">
        <form [formGroup]="maintenanceForm" (ngSubmit)="onSubmit()" class="maintenance-form">
          
          <div class="form-grid">
            
            <!-- Left Column -->
            <div class="form-column">
              
              <!-- Maintenance Type -->
              <div class="form-group">
                <label class="form-label" for="maintenanceTypeId">
                  <i class="fas fa-wrench"></i>
                  Bakım Türü <span class="required">*</span>
                </label>
                <select 
                  id="maintenanceTypeId"
                  formControlName="maintenanceTypeId"
                  class="form-select"
                  [class.is-invalid]="maintenanceForm.get('maintenanceTypeId').invalid && maintenanceForm.get('maintenanceTypeId').touched">
                  <option value="">Bakım türü seçin...</option>
                  <option *ngFor="let type of maintenanceTypes" [value]="type.id">
                    {{ type.name }}
                  </option>
                </select>
                <div class="invalid-feedback" *ngIf="maintenanceForm.get('maintenanceTypeId').invalid && maintenanceForm.get('maintenanceTypeId').touched">
                  Bakım türü seçimi zorunludur
                </div>
              </div>

              <!-- Maintenance Date -->
              <div class="form-group">
                <label class="form-label" for="maintenanceDate">
                  <i class="fas fa-calendar-alt"></i>
                  Bakım Tarihi <span class="required">*</span>
                </label>
                <input 
                  type="datetime-local"
                  id="maintenanceDate"
                  formControlName="maintenanceDate"
                  class="form-input"
                  [class.is-invalid]="maintenanceForm.get('maintenanceDate').invalid && maintenanceForm.get('maintenanceDate').touched">
                <div class="invalid-feedback" *ngIf="maintenanceForm.get('maintenanceDate').invalid && maintenanceForm.get('maintenanceDate').touched">
                  Bakım tarihi zorunludur
                </div>
              </div>

              <!-- Machine Working Time/Kilometer -->
              <div class="form-group">
                <label class="form-label" for="machineWorkingTimeOrKilometer">
                  <i class="fas fa-tachometer-alt"></i>
                  Makina Saati/Kilometre <span class="required">*</span>
                </label>
                <input 
                  type="number"
                  id="machineWorkingTimeOrKilometer"
                  formControlName="machineWorkingTimeOrKilometer"
                  class="form-input"
                  placeholder="Örn: 1500"
                  [class.is-invalid]="maintenanceForm.get('machineWorkingTimeOrKilometer').invalid && maintenanceForm.get('machineWorkingTimeOrKilometer').touched">
                <div class="help-text">Bakımın yapıldığı andaki makina saati veya kilometre</div>
                <div class="invalid-feedback" *ngIf="maintenanceForm.get('machineWorkingTimeOrKilometer').invalid && maintenanceForm.get('machineWorkingTimeOrKilometer').touched">
                  Makina saati/kilometre zorunludur ve pozitif bir sayı olmalıdır
                </div>
              </div>

              <!-- Maintenance Firm -->
              <div class="form-group">
                <label class="form-label" for="maintenanceFirm">
                  <i class="fas fa-building"></i>
                  Bakımı Yapan Firma <span class="required">*</span>
                </label>
                <input 
                  type="text"
                  id="maintenanceFirm"
                  formControlName="maintenanceFirm"
                  class="form-input"
                  placeholder="Firma adını girin..."
                  [class.is-invalid]="maintenanceForm.get('maintenanceFirm').invalid && maintenanceForm.get('maintenanceFirm').touched">
                <div class="invalid-feedback" *ngIf="maintenanceForm.get('maintenanceFirm').invalid && maintenanceForm.get('maintenanceFirm').touched">
                  Firma adı zorunludur
                </div>
              </div>

            </div>

            <!-- Right Column -->
            <div class="form-column">
              
              <!-- Next Maintenance Hour -->
              <div class="form-group">
                <label class="form-label" for="nextMaintenanceHour">
                  <i class="fas fa-clock"></i>
                  Sonraki Bakım Saati
                </label>
                <input 
                  type="number"
                  id="nextMaintenanceHour"
                  formControlName="nextMaintenanceHour"
                  class="form-input"
                  placeholder="Örn: 2000"
                  min="0">
                <div class="help-text">Bir sonraki bakımın yapılacağı makine saati</div>
              </div>

              <!-- Parts Changed -->
              <div class="form-group">
                <label class="form-label" for="partsChanged">
                  <i class="fas fa-cog"></i>
                  Değiştirilen/Eklenen Parçalar
                </label>
                <textarea 
                  id="partsChanged"
                  formControlName="partsChanged"
                  class="form-textarea"
                  rows="3"
                  placeholder="Değiştirilen veya eklenen parçaları listeleyin..."></textarea>
                <div class="help-text">Bakım sırasında değiştirilen parçalar</div>
              </div>

              <!-- Oils Changed -->
              <div class="form-group">
                <label class="form-label" for="oilsChanged">
                  <i class="fas fa-oil-can"></i>
                  Değiştirilen Yağlar
                </label>
                <textarea 
                  id="oilsChanged"
                  formControlName="oilsChanged"
                  class="form-textarea"
                  rows="3"
                  placeholder="Değiştirilen yağları listeleyin..."></textarea>
                <div class="help-text">Motor yağı, hidrolik yağ vb.</div>
              </div>

            </div>

          </div>

          <!-- Full Width Description -->
          <div class="form-group full-width">
            <label class="form-label" for="description">
              <i class="fas fa-file-alt"></i>
              Açıklama <span class="required">*</span>
            </label>
            <textarea 
              id="description"
              formControlName="description"
              class="form-textarea"
              rows="4"
              placeholder="Bakım ile ilgili detaylı açıklama girin..."
              [class.is-invalid]="maintenanceForm.get('description').invalid && maintenanceForm.get('description').touched"></textarea>
            <div class="help-text">Yapılan işlemler, sorunlar ve çözümler hakkında detaylı bilgi</div>
            <div class="invalid-feedback" *ngIf="maintenanceForm.get('description').invalid && maintenanceForm.get('description').touched">
              Açıklama zorunludur
            </div>
          </div>

          <!-- File Upload Section -->
          <div class="file-upload-section">
            <div class="section-header">
              <h3>
                <i class="fas fa-paperclip"></i>
                Dosya Ekleri
              </h3>
              <p>Bakım evraklarını, fotoğraflarını veya raporlarını yükleyin (Opsiyonel)</p>
            </div>

            <div class="file-input-wrapper">
              <input 
                type="file" 
                id="fileInput" 
                multiple 
                (change)="onFileSelected($event)"
                accept=".png,.jpg,.jpeg,.gif,.webp,.pdf,.doc,.docx,.xls,.xlsx"
                class="file-input">
              <label for="fileInput" class="file-input-label">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>Dosya seçin veya sürükleyip bırakın</span>
                <span class="file-types">PNG, JPG, PDF, DOC, DOCX, XLS, XLSX</span>
              </label>
            </div>

            <!-- Selected Files List -->
            <div class="selected-files" *ngIf="selectedFiles.length > 0">
              <div class="files-header">
                <h4>Seçili Dosyalar ({{ selectedFiles.length }})</h4>
              </div>
              <div class="files-list">
                <div class="file-item" *ngFor="let file of selectedFiles; let i = index">
                  <div class="file-icon">
                    <i class="fas fa-file-alt"></i>
                  </div>
                  <div class="file-info">
                    <div class="file-name">{{ file.name }}</div>
                    <div class="file-size">{{ formatFileSize(file.size) }}</div>
                  </div>
                  <button type="button" class="remove-file-btn" (click)="removeFile(i)">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              </div>
            </div>

            <!-- Upload Progress -->
            <div class="upload-progress" *ngIf="isUploading">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="uploadProgress"></div>
              </div>
              <div class="progress-text">Yükleniyor: {{ uploadProgress }}%</div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="goBack()" [disabled]="isUploading">
              <i class="fas fa-times"></i>
              İptal
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="maintenanceForm.invalid || isUploading">
              <i class="fas fa-save"></i>
              {{ isUploading ? 'Kaydediliyor...' : 'Kaydet' }}
            </button>
          </div>

        </form>
      </div>

    </div>

  </div>

</div>
